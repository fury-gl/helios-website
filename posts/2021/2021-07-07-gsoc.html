

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta property="og:title" content="Network layout algorithms using IPC" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="http://heliosnetwork.io/posts/2021/2021-07-07-gsoc.html" />
  <meta property="og:image" content="https://heliosnetwork.io/_images/logo.png" />
  <meta property="og:image:alt" content="Network layout algorithms using IPC" />
  <meta name="description" content="Helios is a Python library aiming at providing an easy way to visualize and streaming huge networks dynamically. It incorporates state-of-the-art layout algorithms and new data optimized rendering techniques to provide a high level of interactivity and responsiveness.">
<meta name="image" content="https://heliosnetwork.io/_images/helios-og-face.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="Helios is a Python library aiming at providing an easy way to visualize and streaming huge networks dynamically. It incorporates state-of-the-art layout algorithms and new data optimized rendering techniques to provide a high level of interactivity and responsiveness.">
<meta name="og:type" content="website">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Network layout algorithms using IPC &mdash; Helios beta documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/main.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-rendered-html.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/logo_36.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />    
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Helios
          

          
            
            <img src="../../_static/logo_100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">About Helios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symlink/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blog.html">Blog</a></li>
</ul>
<p class="caption"><span class="caption-text">Working with Helios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_visual_aspects.html">Visual Aspects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_layouts.html">Network Layouts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_streaming.html">Streaming and Colaboration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples_gallery/index.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Developers Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../symlink/contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Join our community!</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/fury-gl/helios/graphs/contributors">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">Communities</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/6btFPPj">Discord Community</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/fury-gl/helios">Source Code</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Helios</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Network layout algorithms using IPC</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             <div class="section" id="network-layout-algorithms-using-ipc">
<h1>Network layout algorithms using IPC<a class="headerlink" href="#network-layout-algorithms-using-ipc" title="Permalink to this headline">¶</a></h1>
<p>
In this post I will discuss the most challenging task that I faced to implement those new network layout methods and
how I solved it.
</p>
<h3>The problem: network layout algorithm implementations with a blocking behavior
</h3>
<p>
<strong>Case 1:</strong> Suppose that you need to monitor a hashtag and build a
social graph. You want to interact with
the graph and at the same time get insights about the structure of the user
interactions. To get those insights you can
perform a node embedding using any kind of network layout algorithm, such as
force-directed or minimum distortion
embeddings.
</p>
<p>
<strong>Case 2:</strong> Suppose that you are modelling a network dynamic such
as an epidemic spreading or a Kuramoto
model. In some of those network dynamics a node can change the state and the
edges related to the node must be deleted. For
example, in an epidemic model a node can represent a person who died due to a
disease. Consequently, the layout of the
network must be recomputed to give better insights.
</p>
<p>
In described cases if we want a better (UX) and at the same time a more practical
and insightful application of Helios
layouts algorithms shouldn’t block any kind of computation in the main thread.
</p>
<p>
In Helios we already have a lib written in C (with a python wrapper) which
performs the force-directed layout algorithm
using separated threads avoiding the GIL problem and consequently avoiding the
blocking. But and the other open-source
network layout libs available on the internet? Unfortunately, most of those libs
have not been implemented like Helios
force-directed methods and consequently, if we want to update the network layout
the python interpreter will block the
computation and user interaction in your network visualization. How to solve
this problem?
</p>
<h3>
Why is using the python threading is not a good solution?
</h3>
<p>
One solution to remove the blocking behavior of the network layout libs like
PyMDE is to use the threading module from
python. However, remember the GIL problem: only one thread can execute python
code at once. Therefore, this solution
will be unfeasible for networks with more than some hundreds of nodes or even
less! Ok, then how to solve it well?
</p>
<h3>IPC using python</h3>
<p>
As I said in my previous posts I’ve created a streaming system for data
visualization for FURY using webrtc. The streaming system is already working
and an important piece in this system was implemented using the python
SharedMemory from multiprocessing. We can get the same ideas from the streaming
system to remove the blocking behavior
of the network layout libs.
</p>
<p>
My solution to have PyMDE and CuGraph-ForceAtlas without blocking was to break
the network layout method into two
different types of processes: A and B.
The list below describes the most important behaviors and responsibilities for each process
</p>
<p>
<strong>Process A:</strong>
</p><ul>
<li>
Where the visualization (NetworkDraw) will happen
</li>
<li>
Create the shared memory resources: edges, weights, positions, info..
</li>
<li>
Check if the process B has updated the shared memory resource which
stores the positions using the timestamp
stored in the info_buffer
</li>
<li>
Update the positions inside of NetworkDraw instance
</li>
</ul>
<p>
<strong>
Process B:
</strong>
</p><ul>
<li>
Read the network information stored in the shared memory resources:
edges , weights, positions
</li>
<li>
Execute the network layout algorithm
</li>
<li>
Update the positions values inside of the shared memory resource
</li>
<li>
Update the timestamp inside of the shared memory resource
</li></ul>
<p>
I used the timestamp information to avoid unnecessary updates in the FURY/VTK
window instance, which can consume a lot
of computational resources.
</p>
<h4>
How have I implemented the code for A and B?
</h4>
<p>
Because we need to deal with a lot of different data and share them between
different processes I’ve created a set of
tools to deal with that, take a look for example in the
<a href="https://github.com/fury-gl/helios/blob/main/helios/layouts/ipc_tools.py#L111">
ShmManagerMultiArrays Object
</a>,
which makes the memory management less
painful.
</p>
<p>
I'm breaking the layout method into two different processes. Thus I’ve
created two abstract objects to deal with
any kind of network layout algorithm which must be performed using
inter-process-communication (IPC). Those objects are:
<a href="https://github.com/devmessias/helios/blob/a0a24525697ec932a398db6413899495fb5633dd/helios/layouts/base.py#L65">
NetworkLayoutIPCServerCalc
</a>;
used by
processes of type B and
<a href="https://github.com/devmessias/helios/blob/a0a24525697ec932a398db6413899495fb5633dd/helios/layouts/base.py#L135">
NetworkLayoutIPCRender
</a>;
which
should be used by processes of type A.
</p>
<p>
I’ll not bore you with the details of the implementation. But let’s take a look
into some important points.
As I’ve said saving the timestamp after each step of the network layout
algorithm. Take a look into the method
_check_and_sync from NetworkLayoutIPCRender
<a href="https://github.com/fury-gl/helios/blob/a0a24525697ec932a398db6413899495fb5633dd/helios/layouts/base.py#L266"> here</a>.
Notice that the update happens only if the stored timestamp has been changed.
Also, look at this line <a href="https://github.com/fury-gl/helios/blob/a0a24525697ec932a398db6413899495fb5633dd/helios/layouts/mde.py#L180">helios/layouts/mde.py#L180</a>, the IPC-PyMDE implementation
This line writes a value 1 into the second element of the info_buffer. This value
is used to inform the process A that everything worked well. I used that info
for example in the tests for the network layout method, see the link
<a href="https://github.com/fury-gl/helios/blob/a0a24525697ec932a398db6413899495fb5633dd/helios/tests/test_mde_layouts.py#L43">
helios/tests/test_mde_layouts.py#L43
</a>
</p>
<h3>Results</h3>
<p>
Until now Helios has three network layout methods implemented: Force Directed ,
Minimum Distortion Embeddings and Force Atlas 2.
Here
<a href="https://github.com/fury-gl/helios/blob/a0a24525697ec932a398db6413899495fb5633dd/docs/examples/viz_helios_mde.ipynb">
docs/examples/viz_helios_mde.ipynb
</a>
you can get a jupyter notebook that I’ve a created showing how to use MDE with
IPC in Helios.
</p>
<p>
In the animation below we can see the result of the Helios-MDE application into
a network with a set of anchored nodes.
</p>
<img src="https://user-images.githubusercontent.com/6979335/125310065-a3a9f480-e308-11eb-98d9-0ff5406a0e96.gif">
<h3>Next steps
</h3>
<p>
I’ll probably focus on the Helios network visualization system. Improving the
documentation and testing the ForceAtlas2 in a computer with cuda installed. See
the list of opened
<a href="https://github.com/fury-gl/helios/issues">issues</a>
</p>
<h3>Summary of most important pull-requests:
</h3>
<ul>
<li>
IPC tools for network layout methods (helios issue #7)
<a href="https://github.com/fury-gl/helios/pull/6">
fury-gl/helios/pull/6 </a>
</li>
<li>
New network layout methods for fury (helios issue #7)
<a href="https://github.com/fury-gl/helios/pull/9">fury-gl/helios/pull/9</a>
<a href="https://github.com/fury-gl/helios/pull/14">fury-gl/helios/pull/14</a>
<a href="https://github.com/fury-gl/helios/pull/13">fury-gl/helios/pull/13</a>
</li>
<li>
Improved the visual aspects and configurations of the network rendering(helios issue #12)
<a href="https://github.com/devmessias/helios/tree/fury_network_actors_improvements">
https://github.com/devmessias/helios/tree/fury_network_actors_improvements
</a>
</li>
<li>
Tests, examples and documentation for Helios (helios issues #3 and #4)
<a href="https://github.com/fury-gl/helios/pull/5">fury-gl/helios/pull/5</a>
</li>
<li>
Reduced the flickering effect on the FURY/Helios streaming system
<a href="https://github.com/fury-gl/helios/pull/10">fury-gl/helios/pull/10</a>
<a href="https://github.com/fury-gl/fury/pull/437/commits/a94e22dbc2854ec87b8c934f6cabdf48931dc279">fury-gl/fury/pull/437/commits/a94e22dbc2854ec87b8c934f6cabdf48931dc279</a>
</li></ul></div>

<div class="section">
     
<div class="section">
  <span style="float: left">
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
    
  </span>
</div>
  
</div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021-2021, Helios.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>